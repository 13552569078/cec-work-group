<template>
  <hl-group gap="var(--sm)" class="hl-panel borderless today-condition" :class="show ? 'incoming' : ''">
    <hb-data-collect gap="var(--sm)" radius="0" class="border border-transparent hover:border-primary">
      <hl-icon type="primary" effect="light" size="lg" fill class="static">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="design-iconfont">
          <g fill="#71F8FC" fill-rule="evenodd">
            <path d="M14.4444444,0 L14.4444444,8 L9.77777778,8 L16,14.4 L22.2222222,8 L17.5555556,8 L17.5555556,0 L28.4444444,0 C29.3035541,0 30,0.7163444 30,1.6 L30,30.4 C30,31.2836556 29.3035541,32 28.4444444,32 L3.55555556,32 C2.69644594,32 2,31.2836556 2,30.4 L2,1.6 C2,0.7163444 2.69644594,0 3.55555556,0 L14.4444444,0 Z M28,22 L6,22 L6,28 L28,28 L28,22 Z" />
            <path opacity=".31999999" d="M24 24L24 28 20 28 20 24z" />
          </g>
        </svg>
      </hl-icon>
      <hl-group dir="vertical" full="full-x" class="content">
        <div class="float-number" style="animation-delay: 0.5s">{{ statData.accessAddNumber ? `+${statData.accessAddNumber}` : '' }}</div>
        <h2 class="font-din">{{ statData.accessNumber }}</h2>
        <span class="text-secondary">接入数据</span>
      </hl-group>
    </hb-data-collect>

    <hb-data-collect gap="var(--sm)" radius="0" class="border border-transparent hover:border-primary">
      <hl-icon type="primary" effect="light" size="lg" fill class="static">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="design-iconfont">
          <g fill="#71F8FC" fill-rule="evenodd">
            <path d="M16,6 C22.627417,6 28,11.372583 28,18 L28,28 C29.1045695,28 30,28.8954305 30,30 C30,31.1045695 29.1045695,32 28,32 L4,32 C2.8954305,32 2,31.1045695 2,30 C2,28.8954305 2.8954305,28 4,28 L4,18 C4,11.372583 9.372583,6 16,6 Z M16.41676,13.2862952 C16.41676,13.021671 16.1174443,12.9151759 15.9536677,13.0755236 L15.8930439,13.1608983 L12.0278715,21.2674335 C11.9541087,21.427253 12.0340184,21.6075621 12.1822271,21.6632257 L12.2786652,21.6805053 L15.5758637,21.6731291 L15.58324,26.6890016 C15.58324,26.9536258 15.8825557,27.0601208 16.0463323,26.8997731 L16.1069561,26.8143984 L19.9721285,18.7078633 C20.0458913,18.5480438 19.9659816,18.3677347 19.8177729,18.312071 L19.7213348,18.2947914 L16.4241363,18.3021677 L16.41676,13.2862952 Z" />
            <path d="M3.75844391,6.81694637 L4.52448835,7.45973398 C5.15910034,7.99223667 5.24187629,8.93837006 4.7093736,9.57298206 C4.17687091,10.2075941 3.23073752,10.29037 2.59612552,9.75786731 L1.83008108,9.1150797 C1.19546908,8.58257701 1.11269314,7.63644361 1.64519583,7.00183162 C2.17769852,6.36721962 3.12383191,6.28444368 3.75844391,6.81694637 Z M28.3151111,6.81694637 C28.9497231,6.28444368 29.8958565,6.36721962 30.4283592,7.00183162 C30.9124525,7.57875161 30.8880512,8.41312731 30.4028204,8.9601412 L30.2434739,9.1150797 L29.4774295,9.75786731 C28.8428175,10.29037 27.8966841,10.2075941 27.3641814,9.57298206 C26.8800881,8.99606206 26.9044894,8.16168637 27.3897202,7.61467247 L27.5490667,7.45973398 L28.3151111,6.81694637 Z M9.67285075,2.4056565 L10.095469,3.31196429 C10.4455774,4.06277424 10.1207447,4.95524493 9.36993473,5.30535336 C8.61912477,5.6554618 7.72665409,5.33062903 7.37654565,4.57981908 L6.95392739,3.67351129 C6.60381896,2.92270133 6.92865173,2.03023065 7.67946168,1.68012222 C8.43027163,1.33001378 9.32274232,1.65484655 9.67285075,2.4056565 Z M22.4565457,2.4056565 C22.8066541,1.65484655 23.6991248,1.33001378 24.4499347,1.68012222 C25.1381772,2.00105494 25.4684805,2.77772262 25.2490789,3.48325338 L25.175469,3.67351129 L24.7528508,4.57981908 C24.4027423,5.33062903 23.5102716,5.6554618 22.7594617,5.30535336 C22.0712192,4.98442063 21.7409159,4.20775295 21.9603175,3.5022222 L22.0339274,3.31196429 L22.4565457,2.4056565 Z M16,0 C16.8284271,0 17.5,0.671572875 17.5,1.5 L17.5,2.5 C17.5,3.32842712 16.8284271,4 16,4 C15.1715729,4 14.5,3.32842712 14.5,2.5 L14.5,1.5 C14.5,0.671572875 15.1715729,0 16,0 Z" opacity=".31999999" />
          </g>
        </svg>
      </hl-icon>
      <hl-group dir="vertical" full="full-x" class="content">
        <div class="float-number" style="animation-delay: 1s">{{ statData.alarmAddNumber ? `+${statData.alarmAddNumber}` : '' }}</div>
        <h2 class="font-din">{{ statData.alarmNumber }}</h2>
        <span class="text-secondary">{{ systemName }}信息</span>
      </hl-group>
    </hb-data-collect>

    <hb-data-collect gap="var(--sm)" radius="0" class="border border-transparent hover:border-primary">
      <hl-icon type="primary" effect="light" size="lg" fill class="static">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="design-iconfont">
          <g fill="#71F8FC" fill-rule="evenodd">
            <path d="M11.388536,27.0825132 C12.835836,27.6855461 14.3942529,28 16,28 C17.6057471,28 19.164164,27.6855461 20.611464,27.0825132 C21.6310688,26.657684 22.8020139,27.139845 23.2268431,28.1594498 C23.6516722,29.1790546 23.1695113,30.3499997 22.1499065,30.7748288 C20.2172603,31.5800864 18.1361905,32 16,32 C13.8638095,32 11.7827397,31.5800864 9.85009349,30.7748288 C8.83048869,30.3499997 8.34832777,29.1790546 8.77315695,28.1594498 C9.19798612,27.139845 10.3689312,26.657684 11.388536,27.0825132 Z M13.8637687,2.01718949 C14.1828978,3.07465361 13.5843591,4.19060294 12.5268949,4.50973208 C12.1468407,4.62442758 11.773251,4.75794129 11.4072776,4.90969663 C9.9521377,5.51308815 8.62933385,6.4001034 7.51471863,7.51471863 C5.27750837,9.75192888 4,12.7722979 4,16 C4,17.820609 4.40439003,19.579705 5.17314569,21.1823763 C5.48241748,21.8271339 5.84906995,22.4429448 6.26822595,23.0226187 C6.91545096,23.9177017 6.71452237,25.1679893 5.81943938,25.8152143 C4.92435639,26.4624394 3.67406871,26.2615108 3.0268437,25.3664278 C2.46819493,24.5938417 1.97925647,23.7726454 1.56659132,22.9123375 C0.540210248,20.7725789 2.13162821e-14,18.4226652 2.13162821e-14,16 C2.13162821e-14,11.7005277 1.70637211,7.66621089 4.6862915,4.6862915 C6.1705924,3.2019906 7.93340507,2.0199244 9.87512906,1.21476485 C10.3640962,1.01200867 10.8633284,0.833592769 11.3712261,0.680315737 C12.4286902,0.361186598 13.5446395,0.959725363 13.8637687,2.01718949 Z M20.6287739,0.680315737 C21.1366716,0.833592769 21.6359038,1.01200867 22.1248709,1.21476485 C24.0665949,2.0199244 25.8294076,3.2019906 27.3137085,4.6862915 C30.2936279,7.66621089 32,11.7005277 32,16 C32,18.4226652 31.4597898,20.7725789 30.4334087,22.9123375 C30.0207435,23.7726454 29.5318051,24.5938417 28.9731563,25.3664278 C28.3259313,26.2615108 27.0756436,26.4624394 26.1805606,25.8152143 C25.2854776,25.1679893 25.084549,23.9177017 25.7317741,23.0226187 C26.1509301,22.4429448 26.5175825,21.8271339 26.8268543,21.1823763 C27.59561,19.579705 28,17.820609 28,16 C28,12.7722979 26.7224916,9.75192888 24.4852814,7.51471863 C23.3706661,6.4001034 22.0478623,5.51308815 20.5927224,4.90969663 C20.226749,4.75794129 19.8531593,4.62442758 19.4731051,4.50973208 C18.4156409,4.19060294 17.8171022,3.07465361 18.1362313,2.01718949 C18.4553605,0.959725363 19.5713098,0.361186598 20.6287739,0.680315737 Z M16,6 C21.5228475,6 26,10.4771525 26,16 C26,18.6865064 24.9330308,21.2091048 23.0710678,23.0710678 C22.2900192,23.8521164 21.0236893,23.8521164 20.2426407,23.0710678 C19.4615921,22.2900192 19.4615921,21.0236893 20.2426407,20.2426407 C21.3618946,19.1233868 22,17.6147361 22,16 C22,12.6862915 19.3137085,10 16,10 C12.6862915,10 10,12.6862915 10,16 C10,17.6147361 10.6381054,19.1233868 11.7573593,20.2426407 C12.5384079,21.0236893 12.5384079,22.2900192 11.7573593,23.0710678 C10.9763107,23.8521164 9.70998077,23.8521164 8.92893219,23.0710678 C7.06696915,21.2091048 6,18.6865064 6,16 C6,10.4771525 10.4771525,6 16,6 Z" />
            <path opacity=".4782911" d="M16 12A4 4 0 1 0 16 20A4 4 0 1 0 16 12Z" />
          </g>
        </svg>
      </hl-icon>
      <hl-group dir="vertical" full="full-x" class="content">
        <div class="float-number" style="animation-delay: 1.5s">{{ statData.judgeAddNumber ? `+${statData.judgeAddNumber}` : '' }}</div>
        <h2 class="font-din">{{ statData.judgeNumber }}</h2>
        <span class="text-secondary">{{ systemName }}研判</span>
      </hl-group>
    </hb-data-collect>

    <hl-group class="border border-transparent hover:border-primary">
      <hb-data-collect gap="var(--sm)" radius="0">
        <hl-icon type="warning" effect="light" size="lg" fill class="static">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="design-iconfont">
            <g fill="#E7BB22" fill-rule="evenodd">
              <path d="M29,0 C29.5522847,-1.01453063e-16 30,0.44771525 30,1 L30.001282,18.709804 C28.5353617,17.0481207 26.3900817,16 24,16 C19.581722,16 16,19.581722 16,24 C16,28.2927261 19.3810544,31.7957647 23.625434,31.9913863 L23.625,32 L3,32 C2.44771525,32 2,31.5522847 2,31 L2,1 C2,0.44771525 2.44771525,1.01453063e-16 3,0 L29,0 Z M13,12 L9,12 C8.44771525,12 8,12.4477153 8,13 C8,13.4909198 8.35375032,13.8992167 8.82024874,13.9838887 L9,14 L13,14 C13.5522847,14 14,13.5522847 14,13 C14,12.5090802 13.6462497,12.1007833 13.1797513,12.0161113 L13,12 Z M19,6 L9,6 C8.44771525,6 8,6.44771525 8,7 C8,7.49091978 8.35375032,7.89921674 8.82024874,7.98388866 L9,8 L19,8 C19.5522847,8 20,7.55228475 20,7 C20,6.50908022 19.6462497,6.10078326 19.1797513,6.01611134 L19,6 Z" />
              <path d="M24,18 C27.3137085,18 30,20.6862915 30,24 C30,27.3137085 27.3137085,30 24,30 C20.6862915,30 18,27.3137085 18,24 C18,20.6862915 20.6862915,18 24,18 Z M28.0876971,21.5500945 C27.8392211,21.253921 27.3976955,21.2152545 27.101522,21.4637304 L27.101522,21.4637304 L23.106,24.812 L21.0834923,22.8816511 L20.9546567,22.7841598 C20.6809212,22.623028 20.3226822,22.6647286 20.0938032,22.9043556 C19.8267778,23.1839203 19.8369429,23.6270192 20.1165077,23.8940447 L20.1165077,23.8940447 L22.5935584,26.2599924 L22.712156,26.3512856 C22.9638098,26.5051805 23.2926723,26.4866186 23.5269562,26.2900652 L23.5269562,26.2900652 L28.0013329,22.5362696 L28.1124123,22.4189471 C28.302694,22.1646099 28.3006764,21.8039576 28.0876971,21.5500945 Z" opacity=".31999999" />
            </g>
          </svg>
        </hl-icon>
        <hl-group dir="vertical" full="full-x" class="content">
          <div class="float-number" style="animation-delay: 2s">{{ statData.autoFinishAddNumber ? `+${statData.autoFinishAddNumber}` : '' }}</div>
          <h2 class="font-din">{{ statData.autoFinishNumber }}</h2>
          <span class="text-secondary">自动办结</span>
        </hl-group>
      </hb-data-collect>
      <hb-data-collect gap="var(--sm)" radius="0">
        <hl-icon type="warning" effect="light" size="lg" fill class="static">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="design-iconfont">
            <g fill="#E7BB22" fill-rule="evenodd">
              <path d="M20.2253104,29.3952713 L20.2253104,31.6 C20.2253104,31.8209139 20.0462243,32 19.8253104,32 L2.4,32 C2.1790861,32 2,31.8209139 2,31.6 L2,29.3952713 C2,29.1743574 2.1790861,28.9952713 2.4,28.9952713 L19.8253104,28.9952713 C20.0462243,28.9952713 20.2253104,29.1743574 20.2253104,29.3952713 Z" opacity=".4782911" />
              <path d="M28.6904179,12.2522129 L26.8824912,14.0625 L26.8824912,14.0625 L25.2594007,13.5229052 L21.4697415,17.30741 L31.6447412,27.4791351 C31.8407025,27.6753824 31.8408317,27.9933062 31.6450301,28.1897129 L30.1920733,29.6445667 C29.9963273,29.8411652 29.678269,29.8413727 29.4819686,29.6453282 C29.481869,29.6452288 29.4817695,29.6451294 29.4819684,29.6447316 L19.3105171,19.4694597 L19.3105171,19.4694597 L15.6310224,23.1475137 L16.0643361,24.8764193 L14.2530386,26.6870077 C14.0567763,26.8830245 13.7387829,26.883 13.5425509,26.6869529 L2.35521643,15.5005472 C2.15933758,15.3042505 2.15922729,14.9863594 2.35496989,14.7899269 L4.16289662,12.9796398 L4.16289662,12.9796398 L5.88880729,13.4127839 L15.5208578,3.78817541 L14.9810517,2.16572045 L16.7923492,0.355132131 C16.9886115,0.159115302 17.3066049,0.159139833 17.5028369,0.355186941 L28.6901713,11.5415926 C28.8860502,11.7378893 28.8861605,12.0557804 28.6904179,12.2522129 Z" />
            </g>
          </svg>
        </hl-icon>
        <hl-group dir="vertical" full="full-x" class="content">
          <div class="float-number" style="animation-delay: 2.5s">{{ statData.eventCenterFinishAddNumber ? `+${statData.autoFinishAddNumber}` : '' }}</div>
          <h2 class="font-din">{{ statData.eventCenterFinishNumber }}</h2>
          <span class="text-secondary">事件中心处置</span>
        </hl-group>
      </hb-data-collect>
    </hl-group>
  </hl-group>
</template>

<script setup lang="ts">
import { ref, watch, inject } from 'vue';
import { useStatistics, useLoop } from '@/hooks';

const systemName = ref(inject('systemName'));

const { statData, getStatData } = useStatistics();
const { setLoop } = useLoop();
const show = ref(false);

getStatData();

watch(
  () => statData.value,
  newVal => {
    Object.keys(newVal).forEach(key => {
      if (key.includes('Add') && newVal[key as keyof typeof newVal] !== 0) {
        show.value = true;
        setTimeout(() => {
          show.value = false;
        }, 5000);
      }
    });
  }
);

setLoop(getStatData, 60);
</script>

<style lang="scss">
.today-condition {
  position: absolute;
  top: calc(var(--xxs) * 24);
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
}
.incoming {
  .float-number {
    animation-duration: 10s;
    animation-fill-mode: forwards;
    animation-name: numberSlider;
  }
}
.float-number {
  position: absolute;
  left: size(32px);
  right: 0;
  top: 0;
  bottom: 0;
  pointer-events: none;
  opacity: 0;
}

@keyframes numberSlider {
  0% {
    opacity: 0;
    transform: translate(0, 50%);
  }

  10% {
    opacity: 1;
    transform: translate(0, 0);
  }

  90% {
    opacity: 1;
    transform: translate(0, 0);
  }
  100% {
    opacity: 0;
    transform: translate(0, -50%);
  }
}
</style>
